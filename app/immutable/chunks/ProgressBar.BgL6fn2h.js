var C=Object.defineProperty;var m=e=>{throw TypeError(e)};var S=(e,s,t)=>s in e?C(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var p=(e,s,t)=>S(e,typeof s!="symbol"?s+"":s,t),w=(e,s,t)=>s.has(e)||m("Cannot "+t);var r=(e,s,t)=>(w(e,s,"read from private field"),t?t.call(e):s.get(e)),i=(e,s,t)=>s.has(e)?m("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(e):s.set(e,t);import{s as u,h as a,f as c,l as y,m as x}from"./runtime.CV-FRLlh.js";import{p as o}from"./proxy.AXJ473x3.js";import{c as U,d as _,o as P,e as E,f as R,a as L}from"./firebase.client.Bh4kUTxx.js";import{o as T}from"./index-client.j3BmQV3R.js";import{v as k,c as F,t as N,x as O}from"./disclose-version.Dwjb0r68.js";const B=function(){if(!n.user)return console.warn("No user to fetch to page doc for."),()=>{};const e=U(_,"users",n.user.uid,"pages");return P(e,s=>{s.docChanges().forEach(t=>{const v=t.doc.data(),D=t.doc.id;(t.type==="added"||t.type==="modified")&&(n.pageDocs[D]=v),t.type==="removed"&&delete n.pageDocs[D]})})},I=function(){if(!n.user)return console.warn("No user to fetch to user doc for."),()=>{};const e=E(_,"users",n.user.uid);return P(e,s=>{if(!s.exists())console.log("Creating firestore user doc..."),R(e,{},{merge:!0});else{console.log("Firestore user doc updated.");const t=s.data();n.userDoc=t}},s=>{console.error("Error while updating firestore user doc",s)})};var h,d,l,g,b;class K{constructor(){i(this,h,u(null));p(this,"_unsubscribeAuth");p(this,"_unsubscribeUserDoc",()=>{});p(this,"_unsubscribePagesCollection",()=>{});i(this,d,u(o({})));i(this,l,u(o({})));i(this,g,u(!1));i(this,b,u(!0));this._unsubscribeAuth=L.onAuthStateChanged(s=>{this._user=s,this.isLoading=!1,this.onAuthChange()})}get _user(){return a(r(this,h))}set _user(s){c(r(this,h),o(s))}get userDoc(){return a(r(this,d))}set userDoc(s){c(r(this,d),o(s))}get pageDocs(){return a(r(this,l))}set pageDocs(s){c(r(this,l),o(s))}get isPublishing(){return a(r(this,g))}set isPublishing(s){c(r(this,g),o(s))}get isLoading(){return a(r(this,b))}set isLoading(s){c(r(this,b),o(s))}get user(){return this._user}onAuthChange(){this.user?(console.warn("Subscribing to user"),this._unsubscribeUserDoc=I(),this._unsubscribePagesCollection=B()):(console.warn("Unsubscribing from user"),this._unsubscribeUserDoc(),this._unsubscribePagesCollection())}destroy(){this._unsubscribeAuth(),this._unsubscribeUserDoc(),this._unsubscribePagesCollection()}}h=new WeakMap,d=new WeakMap,l=new WeakMap,g=new WeakMap,b=new WeakMap;const n=new K;var f;class Y{constructor(){i(this,f,u(""));T(()=>{})}get authRedirect(){return a(r(this,f))}set authRedirect(s){c(r(this,f),o(s))}}f=new WeakMap;const A=Symbol("APPSTATE");function Q(){return y(A,new Y)}function V(){return x(A)}var j=N('<div class="progress-bar svelte-1u2nbnk"><div class="progress-bar-value svelte-1u2nbnk"></div></div>');function W(e){var s=j();k(s),O(s),F(e,s)}export{W as P,n as f,V as g,Q as s};
