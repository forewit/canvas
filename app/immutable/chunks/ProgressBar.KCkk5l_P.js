var y=Object.defineProperty;var _=s=>{throw TypeError(s)};var w=(s,e,t)=>e in s?y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>w(s,typeof e!="symbol"?e+"":e,t),k=(s,e,t)=>e.has(s)||_("Cannot "+t);var o=(s,e,t)=>(k(s,e,"read from private field"),t?t.call(s):e.get(s)),c=(s,e,t)=>e.has(s)?_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);import{s as u,h as n,f as l,L as N,M as E}from"./runtime.B12n482M.js";import{p as a}from"./proxy.zSiyNrLj.js";import{c as R,d as U,o as P,e as C,f as x,g as L,u as i,a as T}from"./userState.svelte.Du53t5um.js";import{o as F}from"./index-client.iHok3rNk.js";import{o as q,c as B,t as I,q as K}from"./disclose-version.Np_JnyxY.js";const M=function(){if(!r.user)return console.warn("No user to fetch to page doc for."),()=>{};const s=R(U,"users",r.user.uid,"pages");return P(s,e=>{e.docChanges().forEach(t=>{const A=t.doc.data(),m=t.doc.id;(t.type==="added"||t.type==="modified")&&(r.pageDocs[m]=A),t.type==="removed"&&delete r.pageDocs[m]})})},W=function(){if(!r.user)return console.warn("No user to fetch to user doc for."),()=>{};const s=C(U,"users",r.user.uid);return P(s,e=>{if(!e.exists())console.log("Creating firestore user doc..."),x(s,{},{merge:!0});else{console.log("Fetched firestore user doc.");const t=e.data();r.userDoc=t,r.triggerUserDocUpdate()}},e=>{console.error("Error while fetching firestore user doc",e)})};async function S(){const s=r.user;if(!s){console.warn("No user to publish to firestore.");return}r.isPublishing=!0;const e=C(U,"users",s.uid);try{console.log("Publishing user State to firestore user doc..."),await L(e,{lastUpdated:i.lastUpdated,themeName:i.themeName,spellcheck:i.spellcheck})}catch(t){console.error("Error while publishing settings to firestore user doc",t)}finally{r.isPublishing=!1}}const Y=function(){i.onUpdate(()=>{i.lastUpdated>r.userDoc.lastUpdated&&S()}),r.onUserDocUpdate(()=>{if(r.userDoc.lastUpdated===i.lastUpdated){console.log("firebaseState and userState are synced.");return}else r.userDoc.lastUpdated>i.lastUpdated?(console.log("userState updated."),r.userDoc.themeName!==void 0&&(i.themeName=r.userDoc.themeName),r.userDoc.spellcheck!==void 0&&(i.spellcheck=r.userDoc.spellcheck)):S()})};var h,p,g,f,b;class j{constructor(){c(this,h,u(null));d(this,"_unsubscribeAuth");d(this,"_unsubscribeUserDoc",()=>{});d(this,"_unsubscribePagesCollection",()=>{});d(this,"_userDocUpdateCallbacks",[]);c(this,p,u(a({})));c(this,g,u(a({})));c(this,f,u(!1));c(this,b,u(!0));this._unsubscribeAuth=T.onAuthStateChanged(e=>{this._user=e,this.isLoading=!1,this.onAuthChange()})}get _user(){return n(o(this,h))}set _user(e){l(o(this,h),a(e))}get userDoc(){return n(o(this,p))}set userDoc(e){l(o(this,p),a(e))}get pageDocs(){return n(o(this,g))}set pageDocs(e){l(o(this,g),a(e))}get isPublishing(){return n(o(this,f))}set isPublishing(e){l(o(this,f),a(e))}get isLoading(){return n(o(this,b))}set isLoading(e){l(o(this,b),a(e))}get user(){return this._user}onAuthChange(){this.user?(console.warn("Subscribing to user."),this._unsubscribeUserDoc=W(),this._unsubscribePagesCollection=M(),Y()):(console.warn("Unsubscribing from user."),this._unsubscribeUserDoc(),this._unsubscribePagesCollection())}onUserDocUpdate(e){this._userDocUpdateCallbacks.push(e)}triggerUserDocUpdate(){this._userDocUpdateCallbacks.forEach(e=>e())}destroy(){console.warn("Unsubscribing from user, userDoc, and pagesCollection."),this._unsubscribeAuth(),this._unsubscribeUserDoc(),this._unsubscribePagesCollection()}}h=new WeakMap,p=new WeakMap,g=new WeakMap,f=new WeakMap,b=new WeakMap;const r=new j;var D;class z{constructor(){c(this,D,u(""));F(()=>{})}get authRedirect(){return n(o(this,D))}set authRedirect(e){l(o(this,D),a(e))}}D=new WeakMap;const v=Symbol("APPSTATE");function Z(){return N(v,new z)}function $(){return E(v)}var G=I('<div class="progress-bar svelte-1u2nbnk"><div class="progress-bar-value svelte-1u2nbnk"></div></div>');function ee(s){var e=G();q(e),K(e),B(s,e)}export{ee as P,r as f,$ as g,Z as s};
