import{p as o}from"./if.iSSDrv-K.js";import{G as b,J as U,K as p,L as c,m as d}from"./runtime.A5g2blTK.js";import{a as w}from"./app.svelte.CDQhUUHo.js";function y(){let n=o({});const r=w();r.subscribeToCollection(["pages"],f);function f(t,e){let s=n[t];if(!e){s&&delete n[t],console.log("deleted page",t.slice(0,4));return}let{wasValid:i,sanitizedPage:a}=P(e);if(!i){console.warn("Ignoring invalid page",e);return}if(!s){n[t]=g(t,a),console.log("added page",t);return}a.lastUpdated<s.lastUpdated?r.publishDoc(["pages",t],s):a.lastUpdated>s.lastUpdated?n[t]=g(t,a):a.lastUpdated===s.lastUpdated&&console.log("page synced with firebase",t)}function P(t){let e={title:"New Page",content:"",lastUpdated:Date.now()};const s=Object.hasOwn(t,"lastUpdated")&&typeof t.lastUpdated=="number"&&Object.hasOwn(t,"title")&&typeof t.title=="string"&&Object.hasOwn(t,"content")&&typeof t.content=="string";return s&&(e.lastUpdated=t.lastUpdated,e.title=t.title,e.content=t.content),{wasValid:s,sanitizedPage:e}}const g=function(t,e){let s=p(o(e.lastUpdated)),i=p(o(e.title)),a=p(o(e.content));return{get lastUpdated(){return c(s)},set lastUpdated(l){d(s,o(l))},get title(){return c(i)},set title(l){l!==c(i)&&(d(i,o(l)),d(s,o(Date.now())),r.publishDoc(["pages",t],n[t]))},get content(){return c(a)},set content(l){l!==c(a)&&(d(a,o(l)),d(s,o(Date.now())),r.publishDoc(["pages",t],n[t]))}}};return new Proxy(n,{set:(t,e,s)=>(t[e]=g(e,s),r.publishDoc(["pages",e],s),!0),deleteProperty:(t,e)=>(delete t[e],r.publishDoc(["pages",e],null),!0)})}const u=Symbol("pages"),C=()=>{const n=y();return b(u,n)},O=()=>U(u);export{O as g,C as s};
