import{p as n}from"./proxy.DVTm-heb.js";import{t as U,v as D,w as P,x as d,y as c}from"./runtime.CmlS14Bi.js";import{g as b}from"./app.svelte.BGOzEepb.js";function w(){let o=n({});const r=b();r.subscribeToPages(g);function g(t){let e=o[t],a=r.pagesCollection[t];if(!a){e&&delete o[t],console.log("deleted page",t.slice(0,4));return}let{wasValid:i,sanitizedPage:s}=p(a);if(!i){console.warn("Sanitized invalid page",a,s),r.publishDataToPageDoc(t,s);return}if(!e){o[t]=u(t,s),console.log("added page",t.slice(0,4));return}s.lastUpdated<e.lastUpdated?r.publishDataToPageDoc(t,e):s.lastUpdated>e.lastUpdated?o[t]=u(t,s):s.lastUpdated===e.lastUpdated&&console.log("page synced with firebase",t.slice(0,4))}function p(t){return{wasValid:t.lastUpdated!==void 0&&t.title!==void 0&&t.content!==void 0,sanitizedPage:{title:t.title===void 0?"New Page":t.title,content:t.content===void 0?"":t.content,lastUpdated:t.lastUpdated===void 0?Date.now():t.lastUpdated}}}const u=function(t,e){let a=P(n(e.lastUpdated)),i=P(n(e.title)),s=P(n(e.content));return{get lastUpdated(){return d(a)},set lastUpdated(l){c(a,n(l))},get title(){return d(i)},set title(l){l!==d(i)&&(c(i,n(l)),c(a,n(Date.now())),g(t))},get content(){return d(s)},set content(l){l!==d(s)&&(c(s,n(l)),c(a,n(Date.now())),g(t))}}};return new Proxy(o,{set:(t,e,a)=>(t[e]=u(e,a),t[e].lastUpdated=Date.now(),r.publishDataToPageDoc(e,a),!0),deleteProperty:(t,e)=>(delete t[e],r.publishDataToPageDoc(e),!0)})}const f=Symbol("pages"),h=()=>{const o=w();return U(f,o)},v=()=>D(f);export{v as g,h as s};
