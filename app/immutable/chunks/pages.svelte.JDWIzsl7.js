import{p as n}from"./proxy.BJqUqZur.js";import{t as b,v as U,w as u,x as c,y as d}from"./runtime.BpWpbmr6.js";import{g as w}from"./app.svelte.Cr2D7b-O.js";function y(){let o=n({});const l=w();l.subscribeToPages(f);function f(t,a){let e=o[t],r=l.pagesCollection[t];if(a==="removed"){e&&delete o[t],console.log("deleted page",t.slice(0,4));return}if(!r){l.publishDataToPageDoc(t,e);return}let{wasValid:i,sanitizedPage:s}=P(r);if(!i){console.warn("Sanitized invalid page",r,s),l.publishDataToPageDoc(t,s);return}if(!e){o[t]=g(t,s),console.log("added page",t.slice(0,4));return}s.lastUpdated<e.lastUpdated?l.publishDataToPageDoc(t,e):s.lastUpdated>e.lastUpdated?o[t]=g(t,s):s.lastUpdated===e.lastUpdated&&console.log("page synced with firebase",t.slice(0,4))}function P(t){let a=!0,e={title:"New Page",content:"",lastUpdated:Date.now()};return typeof t!="object"?{wasValid:!1,sanitizedPage:e}:(Object.hasOwn(t,"lastUpdated")&&typeof t.lastUpdated=="number"?e.lastUpdated=t.lastUpdated:a=!1,Object.hasOwn(t,"title")&&typeof t.title=="string"?e.title=t.title:a=!1,Object.hasOwn(t,"content")&&typeof t.content=="string"?e.content=t.content:a=!1,{wasValid:a,sanitizedPage:e})}const g=function(t,a){let e=u(n(a.lastUpdated)),r=u(n(a.title)),i=u(n(a.content));return{get lastUpdated(){return c(e)},set lastUpdated(s){d(e,n(s))},get title(){return c(r)},set title(s){s!==c(r)&&(d(r,n(s)),d(e,n(Date.now())),f(t,"modified"))},get content(){return c(i)},set content(s){s!==c(i)&&(d(i,n(s)),d(e,n(Date.now())),f(t,"modified"))}}};return new Proxy(o,{set:(t,a,e)=>(t[a]=g(a,e),l.publishDataToPageDoc(a,e),!0),deleteProperty:(t,a)=>(delete t[a],l.publishDataToPageDoc(a),!0)})}const p=Symbol("pages"),C=()=>{const o=y();return b(p,o)},O=()=>U(p);export{O as g,C as s};
