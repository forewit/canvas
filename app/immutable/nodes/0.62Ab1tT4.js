import{h as A,b as N,z as b,y as g,c as p,t as E}from"../chunks/disclose-version.Dwjb0r68.js";import{b as R,E as T,v as F,J as O,w as v,C as l,x as w,u as d,h as i,V as C}from"../chunks/runtime.CV-FRLlh.js";import{o as L,i as j}from"../chunks/index-client.j3BmQV3R.js";import{f as t,s as B,P as W}from"../chunks/ProgressBar.BgL6fn2h.js";import{g as m,a as S,s as z,b as J}from"../chunks/userState.svelte.Cesof772.js";import{g as M}from"../chunks/entry.CDEZsZDx.js";import{h as V}from"../chunks/svelte-head.T12J0saJ.js";import{e as U,d as x,u as D}from"../chunks/firebase.client.Bh4kUTxx.js";function _(e,r,...s){var a=e,n,c;R(()=>{n!==(n=r())&&(c&&(O(c),c=null),n&&(c=F(()=>n(a,...s))))},T),A&&(a=N)}const $=!0,q="always",oe=Object.freeze(Object.defineProperty({__proto__:null,prerender:$,trailingSlash:q},Symbol.toStringTag,{value:"Module"})),G=[{name:"Canvas",bg:"#f0f0f0",bgAlt:"#e6e6e6",main:"#c2c3cc",card:"#ffffff",error:"#ff5c5c",sub:"#bbbcc7",text:"#1a1a1a"},{name:"Paper",bg:"#eeeeee",bgAlt:"#dddddd",main:"#444444",card:"#444444",error:"#d70000",sub:"#b2b2b2",text:"#444444"},{name:"Rose Pine Dawn",bg:"#fffaf3",bgAlt:"#f0e9df",main:"#56949f",card:"#ea9d34",error:"#b4637a",sub:"#c4a7e7",text:"#286983"},{name:"Blueberry Light",bg:"#dae0f5",bgAlt:"#c1c7df",main:"#506477",card:"#df4576",error:"#df4576",sub:"#92a4be",text:"#678198"},{name:"Repose Dark",bg:"#2f3338",bgAlt:"#3a3c3d",main:"#d6d2bc",card:"#d6d2bc",error:"#ff4a59",sub:"#8f8e84",text:"#d6d2bc"},{name:"Carbon",bg:"#313131",bgAlt:"#2b2b2b",main:"#f66e0d",card:"#f66e0d",error:"#e72d2d",sub:"#616161",text:"#f5e6c8"},{name:"Blueberry Dark",bg:"#212b42",bgAlt:"#1b2334",main:"#add7ff",card:"#962f7e",error:"#df4576",sub:"#5c7da5",text:"#91b4d5"},{name:"One Dark",bg:"#2f343f",bgAlt:"#262b34",main:"#61afef",card:"#61afef",error:"#e06c75",sub:"#eceff4",text:"#98c379"},{name:"Dark Note",bg:"#1f1f1f",bgAlt:"#141414",main:"#f2c17b",card:"#e3dce0",error:"#ff0000",sub:"#768f95",text:"#d2dff4"},{name:"Dark",bg:"#111111",bgAlt:"#191919",main:"#eeeeee",card:"#eeeeee",error:"#da3333",sub:"#444444",text:"#eeeeee"}],y=function(){if(!screen)throw new Error("Cannot update safe areas: screen is not defined");const e=document.documentElement;switch(screen.orientation.type){case"portrait-primary":e.style.setProperty("--safe-area-top","env(safe-area-inset-top)"),e.style.setProperty("--safe-area-left","0px"),e.style.setProperty("--safe-area-right","0px");break;case"landscape-primary":e.style.setProperty("--safe-area-top","0px"),e.style.setProperty("--safe-area-left","env(safe-area-inset-left)"),e.style.setProperty("--safe-area-right","0px");break;case"landscape-secondary":e.style.setProperty("--safe-area-top","0px"),e.style.setProperty("--safe-area-left","0px"),e.style.setProperty("--safe-area-right","env(safe-area-inset-right)");break}};var H=E('<meta name="theme-color" content="var(--bg)">');function I(e,r){v(r,!0);const s=m();let a=C(()=>G.find(o=>o.name===s.themeName));l(()=>{const o=d(()=>document.documentElement);i(a)&&(o.style.setProperty("--bg",i(a).bg),o.style.setProperty("--bg-alt",i(a).bgAlt),o.style.setProperty("--main",i(a).main),o.style.setProperty("--card",i(a).card),o.style.setProperty("--error",i(a).error),o.style.setProperty("--sub",i(a).sub),o.style.setProperty("--text",i(a).text))}),l(()=>(screen.orientation.addEventListener("change",y),()=>screen.orientation.removeEventListener("change",y)));var n=b();V(o=>{var f=H();p(o,f)});var c=g(n);_(c,()=>r.children),p(e,n),w()}async function P(e){const r=S(),s=t.user;if(!s){console.warn("No user to publish to firestore.");return}if(!r.pages[e]){console.warn("No page to publish to firestore user doc.");return}t.isPublishing=!0;const a=U(x,"users",s.uid,"pages",e);try{console.log("Publishing page to firestore..."),await D(a,r.pages[e])}catch(n){console.error("Error while publishing page to firestore",n)}finally{t.isPublishing=!1}}async function u(){const e=m(),r=t.user;if(!r){console.warn("No user to publish to firestore.");return}t.isPublishing=!0;const s=U(x,"users",r.uid);try{console.log("Publishing settings to firestore user doc..."),await D(s,{lastUpdated:e.lastUpdated,themeName:e.themeName,spellcheck:e.spellcheck})}catch(a){console.error("Error while publishing settings to firestore user doc",a)}finally{t.isPublishing=!1}}const K=function(){const e=S();l(()=>{Object.entries(t.pageDocs).forEach(([r,s])=>{if(!s.lastUpdated||typeof s.lastUpdated!="number"){d(()=>{console.warn("No page data to sync from firestore. Publishing local page state"),P(r)});return}d(()=>{s.lastUpdated>e.pages[r].lastUpdated?(console.warn("Overwriting local page state with more recent firestore data"),e.pages[r]={...e.pages[r],...s}):(console.warn("Overwriting firestore data with more recent localpage state"),P(r))})})})},Q=function(){const e=m();e.onUpdate(()=>{e.lastUpdated>t.userDoc.lastUpdated&&(console.log("User doc: ðŸ“ƒâ†’ðŸ”¥"),u())}),l(()=>{if(!t.userDoc||!t.userDoc.lastUpdated||typeof t.userDoc.lastUpdated!="number"){d(()=>{console.warn("No ðŸ”¥ user doc: ðŸ“„â†’ðŸ”¥"),u()});return}d(()=>{e.lastUpdated<t.userDoc.lastUpdated?(console.log("User doc: ðŸ”¥â†’ðŸ“„"),t.userDoc.themeName!==void 0&&(e.themeName=t.userDoc.themeName),t.userDoc.spellcheck!==void 0&&(e.spellcheck=t.userDoc.spellcheck),console.log("last user update: "+e.lastUpdated),console.log("last firestore update: "+t.userDoc.lastUpdated)):(console.log("User doc: ðŸ“„â†’ðŸ”¥"),u())})})};function ne(e,r){v(r,!0);const s=B();z(),J(),Q(),K(),l(()=>{s.authRedirect=window.location.pathname}),l(()=>{!t.user&&!t.isLoading&&M("/login/")}),L(()=>{t.destroy()}),I(e,{children:(a,n)=>{var c=b(),o=g(c);j(o,()=>t.isLoading,f=>{W(f)},f=>{var h=b(),k=g(h);_(k,()=>r.children),p(f,h)}),p(a,c)},$$slots:{default:!0}}),w()}export{ne as component,oe as universal};
