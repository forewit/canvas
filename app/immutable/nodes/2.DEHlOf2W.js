import{a as u,t as D,c as Z}from"../chunks/disclose-version.BWbW40b5.js";import{W as ie,n as R,v as ke,ac as E,Y as de,o as e,p as m,ae as S,ad as ye,w as le,af as _,aa as c,ab as s,D as we,ag as xe}from"../chunks/runtime.BgeDY1Ez.js";import{s as q}from"../chunks/render.BY1bb_zd.js";import{e as N,t as I,i as $,B as De}from"../chunks/Button.DIKM1YzD.js";import{s as O,b as Ce,g as Ae}from"../chunks/app.svelte.BaTxSmFg.js";import{d as ve}from"../chunks/events.D_mhI6Gd.js";import{b as ce}from"../chunks/paths.B6ao0nb8.js";import{g as Pe,a as Ue}from"../chunks/directories.svelte.BIe4aDEB.js";import{p,i as T}from"../chunks/if.Bs95Mp5N.js";import{b as Ee}from"../chunks/this.4zZ2LT6D.js";import{p as W,o as Fe}from"../chunks/index-client.B7InVm37.js";var je=(g,t,a)=>{t(e(a))},Be=D('<li><button class="svelte-1p8oues"> </button></li>'),Ie=(g,t,a)=>{t(e(a))},Le=D('<button class="svelte-1p8oues"> </button> <!>',1),Oe=(g,t,a)=>{t(e(a))},qe=D('<button class="svelte-1p8oues"> </button>'),Ke=D("<li><!></li>"),Me=D('<ol class="svelte-1p8oues"></ol>'),Re=(g,t,a,d,y,f,A)=>{t.tree[e(a)].type==="folder"?(e(d).push(e(a)),m(y,p(e(a))),f()(e(a))):f()(e(A))},Se=(g,t,a,d,y,f,A)=>{t.tree[e(a)].type==="folder"?(e(d).push(e(a)),m(y,p(e(a))),f()(e(a))):f()(e(A))},Te=(g,t,a)=>{t(e(a))},We=D('<div class="tree svelte-1p8oues"><div class="controls svelte-1p8oues"><p class="title svelte-1p8oues">My Project</p> <button>+📂</button> <button>+📜</button> <button class="delete-button svelte-1p8oues">-🗑️</button></div> <div class="directory svelte-1p8oues"><!></div></div>');function Ye(g,t){ie(t,!0);const a=(o,K=ye,H)=>{let ae=we(()=>xe(H==null?void 0:H(),0));var ne=Z(),_e=S(ne);T(_e,()=>K().type==="folder",fe=>{var M=Me();N(M,21,()=>K().children,$,(be,n)=>{var se=Z(),me=S(se);T(me,()=>t.tree[e(n)].type==="page",J=>{var B=Be(),C=c(B);C.__click=[je,l,n];var Q=c(C);s(C),s(B),E(()=>{O(C,"id",e(n)),I(C,"active",e(w)===e(n)),I(C,"selected",e(r)===e(n)),q(Q,`📜 ${t.tree[e(n)].name??""}`)}),u(J,B)},J=>{var B=Z(),C=S(B);T(C,()=>t.tree[e(n)].type==="folder",Q=>{var V=Ke(),pe=c(V);T(pe,()=>e(v).includes(e(n)),X=>{var k=Le(),x=S(k);x.__click=[Ie,l,n];var ge=c(x);s(x);var he=_(x,2);a(he,()=>t.tree[e(n)],()=>e(ae)+1),E(()=>{O(x,"id",e(n)),I(x,"active",e(w)===e(n)),I(x,"selected",e(r)===e(n)),q(ge,`📂 ${t.tree[e(n)].name??""}`)}),u(X,k)},X=>{var k=qe();k.__click=[Oe,l,n];var x=c(k);s(k),E(()=>{O(k,"id",e(n)),I(k,"active",e(w)===e(n)),I(k,"selected",e(r)===e(n)),q(x,`📁 ${t.tree[e(n)].name??""}`)}),u(X,k)}),s(V),u(Q,V)},null,!0),u(J,B)}),u(be,se)}),s(M),E(()=>O(M,"style",`--depth: ${e(ae)??""}`)),u(fe,M)}),u(o,ne)};let d=W(t,"newFolder",3,()=>{}),y=W(t,"newPage",3,()=>{}),f=W(t,"removeChild",3,()=>{}),A=W(t,"active",3,!0),v=R(p(["root"])),r=R("root"),w=R("root"),P=le(()=>{for(const o in t.tree)if(t.tree[o].type==="folder"&&t.tree[o].children.includes(e(r)))return o;return"root"}),L,h=R(p([])),F=le(()=>e(h).findIndex(o=>o.id===e(r)));ke(()=>{e(v).length>0&&Object.keys(t.tree).length>0?m(h,p(Array.from(L.querySelectorAll("button")))):m(h,p([]))});function l(o){t.tree[o].type==="folder"&&(e(v).includes(o)?m(v,p(e(v).filter(K=>K!==o))):e(v).push(o)),m(r,p(o)),m(w,p(o))}function i(){if(e(F)>0){const o=e(h)[e(F)-1];m(r,p(o.id)),o.focus()}}function b(){if(e(F)<e(h).length-1){const o=e(h)[e(F)+1];m(r,p(o.id)),o.focus()}}function U(){console.log("clear focus"),m(r,"root"),m(w,"root"),e(h).forEach(o=>o.blur())}function j(o){confirm("Are you sure you want to delete?")&&(f()(e(P),o),i())}function ee(o){if(console.log(),!(!A()||t.tree.root.type==="folder"&&t.tree.root.children.length<=0))switch(o.key){case"ArrowLeft":e(v).includes(e(r))?l(e(r)):i();break;case"ArrowRight":t.tree[e(r)].type==="folder"&&e(r)!=="root"&&!e(v).includes(e(r))?l(e(r)):b();break;case"ArrowUp":i();break;case"ArrowDown":b();break;case"Enter":o.preventDefault(),l(e(r));break;case"Escape":U();break;case"Tab":o.preventDefault(),o.shiftKey?i():b();break;case"Delete":j(e(r));break}}Fe(()=>(document.addEventListener("keydown",ee),()=>{document.removeEventListener("keydown",ee)}));var Y=We(),z=c(Y),te=_(c(z),2);te.__click=[Re,t,w,v,r,d,P];var oe=_(te,2);oe.__click=[Se,t,w,v,r,y,P];var re=_(oe,2);re.__click=[Te,j,r],s(z);var G=_(z,2);Ee(G,o=>L=o,()=>L);var ue=c(G);a(ue,()=>t.tree.root),s(G),s(Y),E(()=>re.disabled=!e(r)||e(r)==="root"),u(g,Y),de()}ve(["click"]);var ze=(g,t,a)=>{delete t.tree[e(a)]},Ge=D('<p> <button class="close-page-button">❌</button></p>'),He=D('<p> <button class="close-page-button">❌</button></p>'),Je=D('<div class="page-container svelte-12i3js3"><header><!></header> <footer class="svelte-12i3js3"><a><!></a> <section id="orphaned-folders"><p>Orphaned folders:</p> <!></section> <section id="orphaned-pages"><p>Orphaned pages:</p> <!></section></footer></div>');function nt(g,t){ie(t,!0),Ce();const a=Pe();Ae();const d=Ue();var y=Je(),f=c(y),A=c(f);Ye(A,{get tree(){return d.tree},newPage:l=>{const i=crypto.randomUUID().slice(0,8);a[i]={lastUpdated:Date.now(),title:"Untitled",content:""},d.addPageID(l,i)},newFolder:l=>{d.addSubfolder(l)},removeChild:(l,i)=>{d.removeChild(l,i)}}),s(f);var v=_(f,2),r=c(v);O(r,"href",`${ce??""}/profile`);var w=c(r);De(w,{iconURL:`${ce??""}/images/icons/gear.svg`}),s(r);var P=_(r,2),L=_(c(P),2);N(L,17,()=>d.orphanedFolders,$,(l,i)=>{var b=Ge(),U=c(b),j=_(U);j.__click=[ze,d,i],s(b),E(()=>q(U,`💀📁 ${d.tree[e(i)].name??""}`)),u(l,b)}),s(P);var h=_(P,2),F=_(c(h),2);N(F,17,()=>d.orphanedPages,$,(l,i)=>{var b=He(),U=c(b),j=_(U);j.__click=()=>{delete a[e(i)]},s(b),E(()=>q(U,`💀📄 ${a[e(i)].title??""}`)),u(l,b)}),s(h),s(v),s(y),u(g,y),de()}ve(["click"]);export{nt as component};
