import{a as d,t as b,d as te,b as S}from"../chunks/disclose-version.BhGCNZWg.js";import{h as Pe,a1 as G,a as me,u as Me,a3 as I,a4 as H,a2 as C,aq as Ne,b as e,d as U,c as P,a6 as x,a7 as h,a5 as _,ai as A,o as Ce,aw as Ee}from"../chunks/runtime.DGpmsJ_j.js";import{s as T}from"../chunks/render.DhbLvMUA.js";import{i as E}from"../chunks/if.BGW3HUhY.js";import{e as oe,i as re}from"../chunks/each.BVZPuxQC.js";import{b as z}from"../chunks/paths.CIG0eIOV.js";import{g as J,b as Ze}from"../chunks/app.svelte.nf3FegEo.js";import{g as ae}from"../chunks/pages.svelte.Bx4iXsJO.js";import{g as Be}from"../chunks/firebase.svelte.BwEUVfvs.js";import{g as Le}from"../chunks/directories.svelte.CxEjJ-r5.js";import{B as k,a as Fe,T as Oe}from"../chunks/Toggle.Bdx0-udO.js";import{s as pe}from"../chunks/attributes.CsCSMkrp.js";import{i as Ke,p as N}from"../chunks/proxy.CIU44urm.js";import{b as je}from"../chunks/this.BikRZdwo.js";import{o as Ge}from"../chunks/index-client.DWHRIoA8.js";import{p as ne}from"../chunks/props.CXMH2iyB.js";import{l as He}from"../chunks/input.CXHyJOvw.js";function Ue(n,v,o){if(n.multiple)return Ve(n,v);for(var l of n.options){var r=j(l);if(Ke(r,v)){l.selected=!0;return}}(!o||v!==void 0)&&(n.selectedIndex=-1)}function Je(n,v){Pe(()=>{var o=new MutationObserver(()=>{var l=n.__value;Ue(n,l)});return o.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{o.disconnect()}})}function Qe(n,v,o){var l=!0;He(n,"change",()=>{var r;if(n.multiple)r=[].map.call(n.querySelectorAll(":checked"),j);else{var u=n.querySelector(":checked");r=u&&j(u)}o(r)}),Pe(()=>{var r=v();if(Ue(n,r,l),l&&r===void 0){var u=n.querySelector(":checked");u!==null&&(r=j(u),o(r))}n.__value=r,l=!1}),Je(n)}function Ve(n,v){for(var o of n.options)o.selected=~v.indexOf(j(o))}function j(n){return"__value"in n?n.__value:n.value}var We=b('<li><div class="button svelte-rpge36"><!></div></li>'),Xe=b('<div class="button svelte-rpge36"><!></div> <!>',1),Ye=b('<div class="button svelte-rpge36"><!></div>'),et=b("<li><!></li>"),tt=b('<ol class="svelte-rpge36"></ol>'),ot=b('<div class="tree-panel theme-panel svelte-rpge36"><div class="controls svelte-rpge36"><p class="title svelte-rpge36"> </p> <!> <!> <!></div> <div class="directory svelte-rpge36"><!></div></div>');function rt(n,v){G(v,!0);const o=(a,R=Ne,ie)=>{let xe=Ce(()=>Ee(ie==null?void 0:ie(),0));var ke=te(),Se=C(ke);E(Se,()=>R().type==="folder",Te=>{var W=tt();oe(W,21,()=>R().children,re,(Ae,$)=>{var ye=te(),qe=C(ye);E(qe,()=>e(s)[e($)].type==="page",de=>{var Z=We(),X=x(Z),ce=x(X),O=U(()=>e(t)===e($));k(ce,{get id(){return e($)},get selected(){return e(O)},iconURL:`${z??""}/images/icons/font-awesome/feather.svg`,onclick:()=>m(e($)),children:(ve,Y)=>{A();var M=S();I(()=>T(M,u[e(s)[e($)].pageID].title)),d(ve,M)},$$slots:{default:!0}}),h(X),h(Z),d(de,Z)},de=>{var Z=te(),X=C(Z);E(X,()=>e(s)[e($)].type==="folder",ce=>{var O=et(),ve=x(O);E(ve,()=>e(i).includes(e($)),Y=>{var M=Xe(),K=C(M),ue=x(K),fe=U(()=>e(t)===e($));k(ue,{get id(){return e($)},get selected(){return e(fe)},iconURL:`${z??""}/images/icons/font-awesome/folder-open.svg`,onclick:()=>m(e($)),children:(ee,gt)=>{A();var we=S();I(()=>T(we,e(s)[e($)].name)),d(ee,we)},$$slots:{default:!0}}),h(K);var be=_(K,2);o(be,()=>e(s)[e($)],()=>e(xe)+1),d(Y,M)},Y=>{var M=Ye(),K=x(M),ue=U(()=>e(t)===e($));k(K,{get id(){return e($)},get selected(){return e(ue)},iconURL:`${z??""}/images/icons/font-awesome/folder-closed.svg`,onclick:()=>m(e($)),children:(fe,be)=>{A();var ee=S();I(()=>T(ee,e(s)[e($)].name)),d(fe,ee)},$$slots:{default:!0}}),h(M),d(Y,M)}),h(O),d(ce,O)},null,!0),d(de,Z)}),d(Ae,ye)}),h(W),I(()=>pe(W,"style",`--depth: ${e(xe)??""}`)),d(Te,W)}),d(a,ke)},l=J(),r=Le(),u=ae();let s=U(()=>r.tree),i=me(N(["root"])),t=me("root"),y=U(()=>{for(const a in e(s))if(e(s)[a].type==="folder"&&e(s)[a].children.includes(e(t)))return a;return"root"}),f=U(()=>e(s)[e(t)].type==="folder"?e(t):e(y));function m(a){e(s)[a].type==="folder"?e(i).includes(a)?P(i,N(e(i).filter(R=>R!==a))):e(i).push(a):e(s)[a].type==="page"&&(l.currentPageID=e(s)[a].pageID),P(t,N(a))}function L(){e(t)!=="root"&&confirm("Are you sure you want to delete?")&&(r.removeChild(e(y),e(t)),P(t,"root"),Q())}function p(a){if(e(i).push(e(f)),a==="folder")r.addSubfolder(e(f));else if(a==="page"){const R=crypto.randomUUID().slice(0,8);u[R]={lastUpdated:Date.now(),title:"Untitled",content:""},r.addPageID(e(f),R)}}let w,c=U(()=>e(i).length>=0&&w?Array.from(w.querySelectorAll("button")):[]),D=U(()=>e(c).findIndex(a=>a.id===e(t))),g=me(0);Me(()=>{e(t)!=="root"?P(g,N(e(D))):P(g,-1)});function q(){if(P(g,N(Math.min(e(c).length-1,Math.max(0,e(g)-1)))),e(c)[e(g)].id==="delete-node"){q();return}e(c)[e(g)].focus(),e(s)[e(c)[e(g)].id]!==void 0?P(t,N(e(c)[e(g)].id)):P(t,"root")}function B(){if(P(g,N(Math.max(0,Math.min(e(c).length-1,e(g)+1)))),e(c)[e(g)].id==="delete-node"){e(c).length>3?B():q();return}e(c)[e(g)].focus(),e(s)[e(c)[e(g)].id]!==void 0&&P(t,N(e(c)[e(g)].id))}function Q(){e(c).forEach(a=>{a.blur()})}function F(a){a.key==="Escape"?(Q(),P(t,"root")):a.key==="Enter"?e(t)!=="root"&&a.target===document.body&&(m(e(t)),a.preventDefault()):a.key==="Delete"?L():a.key==="ArrowLeft"?e(s)[e(t)].type==="folder"&&e(D)!==-1&&e(i).includes(e(t))?P(i,N(e(i).filter(R=>R!==e(t)))):q():a.key==="ArrowRight"?e(s)[e(t)].type==="folder"&&e(D)!==-1&&!e(i).includes(e(t))?e(i).push(e(t)):B():a.key==="ArrowUp"?q():a.key==="ArrowDown"&&B()}function ge(a){e(c).findIndex(R=>R.id===a.target.id)===-1&&(Q(),P(t,"root"))}Ge(()=>(document.addEventListener("click",ge),document.addEventListener("keydown",F),()=>{document.removeEventListener("click",ge),document.removeEventListener("keydown",F)}));var V=ot();je(V,a=>w=a,()=>w);var le=x(V),se=x(le),ze=x(se);h(se);var _e=_(se,2);k(_e,{id:"new-folder",iconURL:`${z??""}/images/icons/font-awesome/folder-new.svg`,onclick:()=>p("folder")});var he=_(_e,2);k(he,{id:"new-page",iconURL:`${z??""}/images/icons/font-awesome/feather.svg`,onclick:()=>p("page")});var Ie=_(he,2),De=U(()=>!e(t)||e(t)==="root");k(Ie,{id:"delete-node",get disabled(){return e(De)},iconURL:`${z??""}/images/icons/font-awesome/trash.svg`,onclick:()=>{L()}}),h(le);var $e=_(le,2),Re=x($e);o(Re,()=>e(s).root),h($e),h(V),I(()=>T(ze,l.username)),d(n,V),H()}var nt=b('<div class="page-toolbar theme-toolbar svelte-1xv751g"><!> <!> <!></div>');function at(n,v){G(v,!0);let o=ne(v,"openTreePanel",3,()=>{}),l=ne(v,"openSettingsPanel",3,()=>{});const r=J(),u=ae();let s=U(()=>u[r.currentPageID]!==void 0?u[r.currentPageID].title:"Loading...");var i=nt(),t=x(i);k(t,{iconURL:`${z??""}/images/icons/font-awesome/home.svg`,href:`${z??""}/`});var y=_(t,2);k(y,{iconURL:`${z??""}/images/icons/font-awesome/folder-closed.svg`,get onclick(){return l()}});var f=_(y,2);k(f,{get onclick(){return o()},children:(m,L)=>{A();var p=S();I(()=>T(p,e(s))),d(m,p)},$$slots:{default:!0}}),h(i),d(n,i),H()}var lt=b("<!> <!> <!>",1),st=b('<div class="zoom-toolbar theme-toolbar svelte-16pmxx3"><!></div>');function it(n,v){G(v,!0);const o=J(),l=[.25,.5,.75,1,1.25,1.5,1.75,2];function r(){const f=l.find(m=>m>o.zoom);o.zoom=f!==void 0?f:l[l.length-1]}function u(){const f=l.toReversed().find(m=>m<o.zoom);o.zoom=f!==void 0?f:l[0]}function s(){const f=l.find(m=>m>o.zoom);o.zoom=f!==void 0?f:l[0]}function i(){o.zoom=1}var t=st(),y=x(t);E(y,()=>v.variant==="alt",f=>{var m=lt(),L=C(m);k(L,{iconURL:`${z??""}/images/icons/font-awesome/zoom-out.svg`,onclick:u});var p=_(L,2);k(p,{onclick:i,children:(c,D)=>{A();var g=S();I(()=>T(g,`${Math.round(o.zoom*100)??""}%`)),d(c,g)},$$slots:{default:!0}});var w=_(p,2);k(w,{iconURL:`${z??""}/images/icons/font-awesome/zoom-in.svg`,onclick:r}),d(f,m)},f=>{k(f,{onclick:s,children:(m,L)=>{A();var p=S();I(()=>T(p,`${Math.round(o.zoom*100)??""}%`)),d(m,p)},$$slots:{default:!0}})}),h(t),d(n,t),H()}var dt=b("<option> </option>"),ct=b("<select></select>");function vt(n,v){let o=ne(v,"name",3,"Select one"),l=ne(v,"value",15);var r=ct();oe(r,21,()=>v.options,re,(u,s)=>{var i=dt(),t={},y=x(i);h(i),I(()=>{t!==(t=e(s))&&(i.value=(i.__value=e(s))==null?"":e(s)),T(y,e(s))}),d(u,i)}),h(r),I(()=>{pe(r,"name",o()),pe(r,"id",v.id)}),Qe(r,l,u=>l(u)),d(n,r)}var ut=b("<!> <!> <!>",1),ft=b('<div class="settings-panel theme-panel svelte-1rflt3x"><!></div>');function mt(n,v){G(v,!0);const o=J(),l=ae();let r=U(()=>l[o.currentPageID]);var u=ft(),s=x(u);E(s,()=>e(r),i=>{var t=ut(),y=C(t);Fe(y,{get value(){return e(r).title},set value(p){e(r).title=p}});var f=_(y,2);Oe(f,{get checked(){return o.spellcheck},set checked(p){o.spellcheck=p},id:"spellcheck",children:(p,w)=>{A();var c=S("Spellcheck");d(p,c)},$$slots:{default:!0}});var m=_(f,2),L=U(Ze);vt(m,{id:"theme-select",name:"Theme",get options(){return e(L)},get value(){return o.themeName},set value(p){o.themeName=p}}),d(i,t)},i=>{var t=S("Loading...");d(i,t)}),h(u),d(n,u),H()}var pt=b('<div class="page-container svelte-1cqpher"><header></header> <main><!> <!> <!> <!> <!></main> <footer class="svelte-1cqpher"><p>Orphans:</p> <!> <!></footer></div>');function At(n,v){G(v,!0),J();const o=ae();Be();const l=Le();var r=pt(),u=_(x(r),2),s=x(u);k(s,{href:`${z??""}/layout/`,children:(w,c)=>{A();var D=S("Layout");d(w,D)},$$slots:{default:!0}});var i=_(s,2);at(i,{});var t=_(i,2);it(t,{variant:"alt"});var y=_(t,2);rt(y,{});var f=_(y,2);mt(f,{}),h(u);var m=_(u,2),L=_(x(m),2);oe(L,17,()=>l.orphanedFolders,re,(w,c)=>{var D=te(),g=C(D);E(g,()=>l.tree[e(c)].type==="folder",q=>{k(q,{variant:"error",onclick:()=>{delete l.tree[e(c)]},children:(B,Q)=>{A();var F=S();I(()=>T(F,`💀📁${l.tree[e(c)].name??""}`)),d(B,F)},$$slots:{default:!0}})}),d(w,D)});var p=_(L,2);oe(p,17,()=>l.orphanedPages,re,(w,c)=>{k(w,{variant:"error",onclick:()=>{delete l.tree[e(c)],delete o[e(c)]},children:(D,g)=>{A();var q=S();I(()=>T(q,`💀📄${o[e(c)].title??""}`)),d(D,q)},$$slots:{default:!0}})}),h(m),h(r),d(n,r),H()}export{At as component};
