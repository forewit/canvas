import{a as d,t as w,d as ee,b as S}from"../chunks/disclose-version.BhGCNZWg.js";import{h as Pe,a1 as j,a as fe,u as Me,a3 as U,a4 as G,a2 as N,aq as Ne,b as e,d as L,c as P,a6 as x,a7 as _,a5 as h,ai as q,o as Ce,aw as Ee}from"../chunks/runtime.DGpmsJ_j.js";import{s as R}from"../chunks/render.DhbLvMUA.js";import{i as C}from"../chunks/if.BGW3HUhY.js";import{e as te,i as oe}from"../chunks/each.BVZPuxQC.js";import{b as D}from"../chunks/paths.BFKPHO6H.js";import{g as H,b as Ze}from"../chunks/app.svelte.nf3FegEo.js";import{g as ne}from"../chunks/pages.svelte.Bx4iXsJO.js";import{g as Be}from"../chunks/firebase.svelte.BwEUVfvs.js";import{g as Le}from"../chunks/directories.svelte.CxEjJ-r5.js";import{B as b,a as Fe,T as Oe}from"../chunks/Toggle.Bdx0-udO.js";import{s as me}from"../chunks/attributes.CsCSMkrp.js";import{i as Ke,p as A}from"../chunks/proxy.CIU44urm.js";import{b as je}from"../chunks/this.BikRZdwo.js";import{o as Ge}from"../chunks/index-client.DWHRIoA8.js";import{p as re}from"../chunks/props.CXMH2iyB.js";import{l as He}from"../chunks/input.CXHyJOvw.js";function Ue(n,c,o){if(n.multiple)return Ve(n,c);for(var l of n.options){var r=K(l);if(Ke(r,c)){l.selected=!0;return}}(!o||c!==void 0)&&(n.selectedIndex=-1)}function Je(n,c){Pe(()=>{var o=new MutationObserver(()=>{var l=n.__value;Ue(n,l)});return o.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{o.disconnect()}})}function Qe(n,c,o){var l=!0;He(n,"change",()=>{var r;if(n.multiple)r=[].map.call(n.querySelectorAll(":checked"),K);else{var v=n.querySelector(":checked");r=v&&K(v)}o(r)}),Pe(()=>{var r=c();if(Ue(n,r,l),l&&r===void 0){var v=n.querySelector(":checked");v!==null&&(r=K(v),o(r))}n.__value=r,l=!1}),Je(n)}function Ve(n,c){for(var o of n.options)o.selected=~c.indexOf(K(o))}function K(n){return"__value"in n?n.__value:n.value}var We=w('<li><div class="button svelte-rpge36"><!></div></li>'),Xe=w('<div class="button svelte-rpge36"><!></div> <!>',1),Ye=w('<div class="button svelte-rpge36"><!></div>'),et=w("<li><!></li>"),tt=w('<ol class="svelte-rpge36"></ol>'),ot=w('<div class="tree-panel theme-panel svelte-rpge36"><div class="controls svelte-rpge36"><p class="title svelte-rpge36"> </p> <!> <!> <!></div> <div class="directory svelte-rpge36"><!></div></div>');function rt(n,c){j(c,!0);const o=(a,I=Ne,se)=>{let xe=Ce(()=>Ee(se==null?void 0:se(),0));var ke=ee(),Se=N(ke);C(Se,()=>I().type==="folder",Te=>{var V=tt();te(V,21,()=>I().children,oe,(Ae,$)=>{var be=ee(),qe=N(be);C(qe,()=>e(s)[e($)].type==="page",ie=>{var B=We(),W=x(B),de=x(W),F=L(()=>e(t)===e($));b(de,{get id(){return e($)},get selected(){return e(F)},iconURL:`${D??""}/images/icons/font-awesome/feather.svg`,onclick:()=>p(e($)),children:(ce,X)=>{q();var T=S();U(()=>R(T,v[e(s)[e($)].pageID].title)),d(ce,T)},$$slots:{default:!0}}),_(W),_(B),d(ie,B)},ie=>{var B=ee(),W=N(B);C(W,()=>e(s)[e($)].type==="folder",de=>{var F=et(),ce=x(F);C(ce,()=>e(i).includes(e($)),X=>{var T=Xe(),O=N(T),ve=x(O),ue=L(()=>e(t)===e($));b(ve,{get id(){return e($)},get selected(){return e(ue)},iconURL:`${D??""}/images/icons/font-awesome/folder-open.svg`,onclick:()=>p(e($)),children:(Y,gt)=>{q();var we=S();U(()=>R(we,e(s)[e($)].name)),d(Y,we)},$$slots:{default:!0}}),_(O);var ye=h(O,2);o(ye,()=>e(s)[e($)],()=>e(xe)+1),d(X,T)},X=>{var T=Ye(),O=x(T),ve=L(()=>e(t)===e($));b(O,{get id(){return e($)},get selected(){return e(ve)},iconURL:`${D??""}/images/icons/font-awesome/folder-closed.svg`,onclick:()=>p(e($)),children:(ue,ye)=>{q();var Y=S();U(()=>R(Y,e(s)[e($)].name)),d(ue,Y)},$$slots:{default:!0}}),_(T),d(X,T)}),_(F),d(de,F)},null,!0),d(ie,B)}),d(Ae,be)}),_(V),U(()=>me(V,"style",`--depth: ${e(xe)??""}`)),d(Te,V)}),d(a,ke)},l=H(),r=Le(),v=ne();let s=L(()=>r.tree),i=fe(A(["root"])),t=fe("root"),y=L(()=>{for(const a in e(s))if(e(s)[a].type==="folder"&&e(s)[a].children.includes(e(t)))return a;return"root"}),u=L(()=>e(s)[e(t)].type==="folder"?e(t):e(y));function p(a){e(s)[a].type==="folder"?e(i).includes(a)?P(i,A(e(i).filter(I=>I!==a))):e(i).push(a):e(s)[a].type==="page"&&(l.currentPageID=e(s)[a].pageID),P(t,A(a))}function z(){e(t)!=="root"&&confirm("Are you sure you want to delete?")&&(r.removeChild(e(y),e(t)),P(t,"root"),Z())}function f(a){if(e(i).push(e(u)),a==="folder")r.addSubfolder(e(u));else if(a==="page"){const I=crypto.randomUUID().slice(0,8);v[I]={lastUpdated:Date.now(),title:"Untitled",content:""},r.addPageID(e(u),I)}}let k,m=L(()=>e(i).length>=0&&k?Array.from(k.querySelectorAll("button")):[]),M=L(()=>e(m).findIndex(a=>a.id===e(t))),g=fe(0);Me(()=>{e(t)!=="root"?P(g,A(e(M))):P(g,-1)});function E(){if(P(g,A(Math.min(e(m).length-1,Math.max(0,e(g)-1)))),e(m)[e(g)].id==="delete-node"){E();return}e(m)[e(g)].focus(),e(s)[e(m)[e(g)].id]!==void 0?P(t,A(e(m)[e(g)].id)):P(t,"root")}function J(){if(P(g,A(Math.max(0,Math.min(e(m).length-1,e(g)+1)))),e(m)[e(g)].id==="delete-node"){e(m).length>3?J():E();return}e(m)[e(g)].focus(),e(s)[e(m)[e(g)].id]!==void 0&&P(t,A(e(m)[e(g)].id))}function Z(){e(m).forEach(a=>{a.blur()})}function pe(a){a.key==="Escape"?(Z(),P(t,"root")):a.key==="Enter"?e(t)!=="root"&&a.target===document.body&&(p(e(t)),a.preventDefault()):a.key==="Delete"?z():a.key==="ArrowLeft"?e(s)[e(t)].type==="folder"&&e(M)!==-1&&e(i).includes(e(t))?P(i,A(e(i).filter(I=>I!==e(t)))):E():a.key==="ArrowRight"?e(s)[e(t)].type==="folder"&&e(M)!==-1&&!e(i).includes(e(t))?e(i).push(e(t)):J():a.key==="ArrowUp"?E():a.key==="ArrowDown"&&J()}function ge(a){e(m).findIndex(I=>I.id===a.target.id)===-1&&(Z(),P(t,"root"))}Ge(()=>(document.addEventListener("click",ge),document.addEventListener("keydown",pe),()=>{document.removeEventListener("click",ge),document.removeEventListener("keydown",pe)}));var Q=ot();je(Q,a=>k=a,()=>k);var ae=x(Q),le=x(ae),ze=x(le);_(le);var _e=h(le,2);b(_e,{id:"new-folder",iconURL:`${D??""}/images/icons/font-awesome/folder-new.svg`,onclick:()=>f("folder")});var he=h(_e,2);b(he,{id:"new-page",iconURL:`${D??""}/images/icons/font-awesome/feather.svg`,onclick:()=>f("page")});var Ie=h(he,2),De=L(()=>!e(t)||e(t)==="root");b(Ie,{id:"delete-node",get disabled(){return e(De)},iconURL:`${D??""}/images/icons/font-awesome/trash.svg`,onclick:()=>{z()}}),_(ae);var $e=h(ae,2),Re=x($e);o(Re,()=>e(s).root),_($e),_(Q),U(()=>R(ze,l.username)),d(n,Q),G()}var nt=w('<div class="page-toolbar theme-toolbar svelte-1xv751g"><!> <!> <!></div>');function at(n,c){j(c,!0);let o=re(c,"openTreePanel",3,()=>{}),l=re(c,"openSettingsPanel",3,()=>{});const r=H(),v=ne();let s=L(()=>v[r.currentPageID]!==void 0?v[r.currentPageID].title:"Loading...");var i=nt(),t=x(i);b(t,{iconURL:`${D??""}/images/icons/font-awesome/home.svg`,href:`${D??""}/`});var y=h(t,2);b(y,{iconURL:`${D??""}/images/icons/font-awesome/folder-closed.svg`,get onclick(){return l()}});var u=h(y,2);b(u,{get onclick(){return o()},children:(p,z)=>{q();var f=S();U(()=>R(f,e(s))),d(p,f)},$$slots:{default:!0}}),_(i),d(n,i),G()}var lt=w("<!> <!> <!>",1),st=w('<div class="zoom-toolbar theme-toolbar svelte-16pmxx3"><!></div>');function it(n,c){j(c,!0);const o=H(),l=[.25,.5,.75,1,1.25,1.5,1.75,2];function r(){const u=l.find(p=>p>o.zoom);o.zoom=u!==void 0?u:l[l.length-1]}function v(){const u=l.toReversed().find(p=>p<o.zoom);o.zoom=u!==void 0?u:l[0]}function s(){const u=l.find(p=>p>o.zoom);o.zoom=u!==void 0?u:l[0]}function i(){o.zoom=1}var t=st(),y=x(t);C(y,()=>c.variant==="alt",u=>{var p=lt(),z=N(p);b(z,{iconURL:`${D??""}/images/icons/font-awesome/zoom-out.svg`,onclick:v});var f=h(z,2);b(f,{onclick:i,children:(m,M)=>{q();var g=S();U(()=>R(g,`${Math.round(o.zoom*100)??""}%`)),d(m,g)},$$slots:{default:!0}});var k=h(f,2);b(k,{iconURL:`${D??""}/images/icons/font-awesome/zoom-in.svg`,onclick:r}),d(u,p)},u=>{b(u,{onclick:s,children:(p,z)=>{q();var f=S();U(()=>R(f,`${Math.round(o.zoom*100)??""}%`)),d(p,f)},$$slots:{default:!0}})}),_(t),d(n,t),G()}var dt=w("<option> </option>"),ct=w("<select></select>");function vt(n,c){let o=re(c,"name",3,"Select one"),l=re(c,"value",15);var r=ct();te(r,21,()=>c.options,oe,(v,s)=>{var i=dt(),t={},y=x(i);_(i),U(()=>{t!==(t=e(s))&&(i.value=(i.__value=e(s))==null?"":e(s)),R(y,e(s))}),d(v,i)}),_(r),U(()=>{me(r,"name",o()),me(r,"id",c.id)}),Qe(r,l,v=>l(v)),d(n,r)}var ut=w("<!> <!> <!>",1),ft=w('<div class="settings-panel theme-panel svelte-1rflt3x"><!></div>');function mt(n,c){j(c,!0);const o=H(),l=ne();let r=L(()=>l[o.currentPageID]);var v=ft(),s=x(v);C(s,()=>e(r),i=>{var t=ut(),y=N(t);Fe(y,{get value(){return e(r).title},set value(f){e(r).title=f}});var u=h(y,2);Oe(u,{get checked(){return o.spellcheck},set checked(f){o.spellcheck=f},id:"spellcheck",children:(f,k)=>{q();var m=S("Spellcheck");d(f,m)},$$slots:{default:!0}});var p=h(u,2),z=L(Ze);vt(p,{id:"theme-select",name:"Theme",get options(){return e(z)},get value(){return o.themeName},set value(f){o.themeName=f}}),d(i,t)},i=>{var t=S("Loading...");d(i,t)}),_(v),d(n,v),G()}var pt=w('<div class="page-container svelte-1cqpher"><header></header> <main><!> <!> <!> <!></main> <footer class="svelte-1cqpher"><p>Orphans:</p> <!> <!></footer></div>');function At(n,c){j(c,!0),H();const o=ne();Be();const l=Le();var r=pt(),v=h(x(r),2),s=x(v);at(s,{});var i=h(s,2);it(i,{variant:"alt"});var t=h(i,2);rt(t,{});var y=h(t,2);mt(y,{}),_(v);var u=h(v,2),p=h(x(u),2);te(p,17,()=>l.orphanedFolders,oe,(f,k)=>{var m=ee(),M=N(m);C(M,()=>l.tree[e(k)].type==="folder",g=>{b(g,{variant:"error",onclick:()=>{delete l.tree[e(k)]},children:(E,J)=>{q();var Z=S();U(()=>R(Z,`💀📁${l.tree[e(k)].name??""}`)),d(E,Z)},$$slots:{default:!0}})}),d(f,m)});var z=h(p,2);te(z,17,()=>l.orphanedPages,oe,(f,k)=>{b(f,{variant:"error",onclick:()=>{delete l.tree[e(k)],delete o[e(k)]},children:(m,M)=>{q();var g=S();U(()=>R(g,`💀📄${o[e(k)].title??""}`)),d(m,g)},$$slots:{default:!0}})}),_(u),_(r),d(n,r),G()}export{At as component};
