import{a as d,t as w,d as ee,b as S}from"../chunks/disclose-version.zPFKPM9w.js";import{h as Pe,J,a as fe,u as Ne,M as L,N as Q,K as q,ai as qe,b as e,d as P,c as I,Q as x,R as _,O as h,a7 as M,o as Ce,aw as Ee}from"../chunks/runtime.BmmPnVCB.js";import{s as D}from"../chunks/render.Dtaz_-A8.js";import{i as C}from"../chunks/if.CcYKB5Iu.js";import{B as b,e as te,i as oe,a as Ze,T as Oe}from"../chunks/Toggle.Crkk3CyT.js";import{b as R}from"../chunks/paths.Dxuu5E8A.js";import{g as j,b as Be}from"../chunks/app.svelte.ilcwoaLt.js";import{g as ne}from"../chunks/pages.svelte.CUlYedrB.js";import{g as Fe}from"../chunks/firebase.svelte.DTXirxET.js";import{g as Le}from"../chunks/directories.svelte.Bt4sipNX.js";import{s as me}from"../chunks/attributes.BgxIPSn9.js";import{i as Ke,p as A}from"../chunks/proxy.CCWlokwR.js";import{b as Je}from"../chunks/this.Qw69KJUU.js";import{o as Qe}from"../chunks/index-client.CGrVTOoc.js";import{p as re}from"../chunks/props.D67dsuGD.js";import{l as je}from"../chunks/input.DJTMIQlt.js";function Ue(n,c,o){if(n.multiple)return Ve(n,c);for(var l of n.options){var r=K(l);if(Ke(r,c)){l.selected=!0;return}}(!o||c!==void 0)&&(n.selectedIndex=-1)}function Ge(n,c){Pe(()=>{var o=new MutationObserver(()=>{var l=n.__value;Ue(n,l)});return o.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{o.disconnect()}})}function He(n,c,o){var l=!0;je(n,"change",()=>{var r;if(n.multiple)r=[].map.call(n.querySelectorAll(":checked"),K);else{var v=n.querySelector(":checked");r=v&&K(v)}o(r)}),Pe(()=>{var r=c();if(Ue(n,r,l),l&&r===void 0){var v=n.querySelector(":checked");v!==null&&(r=K(v),o(r))}n.__value=r,l=!1}),Ge(n)}function Ve(n,c){for(var o of n.options)o.selected=~c.indexOf(K(o))}function K(n){return"__value"in n?n.__value:n.value}var We=w('<li><div class="button svelte-rpge36"><!></div></li>'),Xe=w('<div class="button svelte-rpge36"><!></div> <!>',1),Ye=w('<div class="button svelte-rpge36"><!></div>'),et=w("<li><!></li>"),tt=w('<ol class="svelte-rpge36"></ol>'),ot=w('<div class="tree-panel theme-panel svelte-rpge36"><div class="controls svelte-rpge36"><p class="title svelte-rpge36"> </p> <!> <!> <!></div> <div class="directory svelte-rpge36"><!></div></div>');function rt(n,c){J(c,!0);const o=(a,z=qe,se)=>{let xe=Ce(()=>Ee(se==null?void 0:se(),0));var ke=ee(),Se=q(ke);C(Se,()=>z().type==="folder",Te=>{var V=tt();te(V,21,()=>z().children,oe,(Ae,$)=>{var be=ee(),Me=q(be);C(Me,()=>e(s)[e($)].type==="page",ie=>{var O=We(),W=x(O),de=x(W),B=P(()=>e(t)===e($));b(de,{get id(){return e($)},get selected(){return e(B)},iconURL:`${R??""}/images/icons/font-awesome/feather.svg`,onclick:()=>p(e($)),children:(ce,X)=>{M();var T=S();L(()=>D(T,v[e(s)[e($)].pageID].title)),d(ce,T)},$$slots:{default:!0}}),_(W),_(O),d(ie,O)},ie=>{var O=ee(),W=q(O);C(W,()=>e(s)[e($)].type==="folder",de=>{var B=et(),ce=x(B);C(ce,()=>e(i).includes(e($)),X=>{var T=Xe(),F=q(T),ve=x(F),ue=P(()=>e(t)===e($));b(ve,{get id(){return e($)},get selected(){return e(ue)},iconURL:`${R??""}/images/icons/font-awesome/folder-open.svg`,onclick:()=>p(e($)),children:(Y,gt)=>{M();var we=S();L(()=>D(we,e(s)[e($)].name)),d(Y,we)},$$slots:{default:!0}}),_(F);var ye=h(F,2);o(ye,()=>e(s)[e($)],()=>e(xe)+1),d(X,T)},X=>{var T=Ye(),F=x(T),ve=P(()=>e(t)===e($));b(F,{get id(){return e($)},get selected(){return e(ve)},iconURL:`${R??""}/images/icons/font-awesome/folder-closed.svg`,onclick:()=>p(e($)),children:(ue,ye)=>{M();var Y=S();L(()=>D(Y,e(s)[e($)].name)),d(ue,Y)},$$slots:{default:!0}}),_(T),d(X,T)}),_(B),d(de,B)},null,!0),d(ie,O)}),d(Ae,be)}),_(V),L(()=>me(V,"style",`--depth: ${e(xe)??""}`)),d(Te,V)}),d(a,ke)},l=j(),r=Le(),v=ne();let s=P(()=>r.tree),i=fe(A(["root"])),t=fe("root"),y=P(()=>{for(const a in e(s))if(e(s)[a].type==="folder"&&e(s)[a].children.includes(e(t)))return a;return"root"}),u=P(()=>e(s)[e(t)].type==="folder"?e(t):e(y));function p(a){e(s)[a].type==="folder"?e(i).includes(a)?I(i,A(e(i).filter(z=>z!==a))):e(i).push(a):e(s)[a].type==="page"&&(l.currentPageID=e(s)[a].pageID),I(t,A(a))}function U(){e(t)!=="root"&&confirm("Are you sure you want to delete?")&&(r.removeChild(e(y),e(t)),I(t,"root"),Z())}function f(a){if(e(i).push(e(u)),a==="folder")r.addSubfolder(e(u));else if(a==="page"){const z=crypto.randomUUID().slice(0,8);v[z]={lastUpdated:Date.now(),title:"Untitled",content:""},r.addPageID(e(u),z)}}let k,m=P(()=>e(i).length>=0&&k?Array.from(k.querySelectorAll("button")):[]),N=P(()=>e(m).findIndex(a=>a.id===e(t))),g=fe(0);Ne(()=>{e(t)!=="root"?I(g,A(e(N))):I(g,-1)});function E(){if(I(g,A(Math.min(e(m).length-1,Math.max(0,e(g)-1)))),e(m)[e(g)].id==="delete-node"){E();return}e(m)[e(g)].focus(),e(s)[e(m)[e(g)].id]!==void 0?I(t,A(e(m)[e(g)].id)):I(t,"root")}function G(){if(I(g,A(Math.max(0,Math.min(e(m).length-1,e(g)+1)))),e(m)[e(g)].id==="delete-node"){e(m).length>3?G():E();return}e(m)[e(g)].focus(),e(s)[e(m)[e(g)].id]!==void 0&&I(t,A(e(m)[e(g)].id))}function Z(){e(m).forEach(a=>{a.blur()})}function pe(a){a.key==="Escape"?Z():a.key==="Enter"?e(t)!=="root"&&a.target===document.body&&(p(e(t)),a.preventDefault()):a.key==="Delete"?U():a.key==="ArrowLeft"?e(s)[e(t)].type==="folder"&&e(N)!==-1&&e(i).includes(e(t))?I(i,A(e(i).filter(z=>z!==e(t)))):E():a.key==="ArrowRight"?e(s)[e(t)].type==="folder"&&e(N)!==-1&&!e(i).includes(e(t))?e(i).push(e(t)):G():a.key==="ArrowUp"?E():a.key==="ArrowDown"&&G()}function ge(a){e(m).findIndex(z=>z.id===a.target.id)===-1&&Z()}Qe(()=>(document.addEventListener("click",ge),document.addEventListener("keydown",pe),()=>{document.removeEventListener("click",ge),document.removeEventListener("keydown",pe)}));var H=ot();Je(H,a=>k=a,()=>k);var ae=x(H),le=x(ae),ze=x(le);_(le);var _e=h(le,2);b(_e,{id:"new-folder",iconURL:`${R??""}/images/icons/font-awesome/folder-new.svg`,onclick:()=>f("folder")});var he=h(_e,2);b(he,{id:"new-page",iconURL:`${R??""}/images/icons/font-awesome/feather.svg`,onclick:()=>f("page")});var Ie=h(he,2),Re=P(()=>!e(t)||e(t)==="root");b(Ie,{id:"delete-node",get disabled(){return e(Re)},iconURL:`${R??""}/images/icons/font-awesome/trash.svg`,onclick:()=>{U()}}),_(ae);var $e=h(ae,2),De=x($e);o(De,()=>e(s).root),_($e),_(H),L(()=>D(ze,l.username)),d(n,H),Q()}var nt=w('<div class="page-toolbar theme-toolbar svelte-1xv751g"><!> <!> <!></div>');function at(n,c){J(c,!0);let o=re(c,"openTreePanel",3,()=>{}),l=re(c,"openSettingsPanel",3,()=>{});const r=j(),v=ne();let s=P(()=>v[r.currentPageID]!==void 0?v[r.currentPageID].title:"Loading...");var i=nt(),t=x(i);b(t,{iconURL:`${R??""}/images/icons/font-awesome/home.svg`,href:`${R??""}/`});var y=h(t,2);b(y,{iconURL:`${R??""}/images/icons/font-awesome/folder-closed.svg`,get onclick(){return l()}});var u=h(y,2);b(u,{get onclick(){return o()},children:(p,U)=>{M();var f=S();L(()=>D(f,e(s))),d(p,f)},$$slots:{default:!0}}),_(i),d(n,i),Q()}var lt=w("<!> <!> <!>",1),st=w('<div class="zoom-toolbar theme-toolbar svelte-16pmxx3"><!></div>');function it(n,c){J(c,!0);const o=j(),l=[.25,.5,.75,1,1.25,1.5,1.75,2];function r(){const u=l.find(p=>p>o.zoom);o.zoom=u!==void 0?u:l[l.length-1]}function v(){const u=l.toReversed().find(p=>p<o.zoom);o.zoom=u!==void 0?u:l[0]}function s(){const u=l.find(p=>p>o.zoom);o.zoom=u!==void 0?u:l[0]}function i(){o.zoom=1}var t=st(),y=x(t);C(y,()=>c.variant==="alt",u=>{var p=lt(),U=q(p);b(U,{iconURL:`${R??""}/images/icons/font-awesome/zoom-out.svg`,onclick:v});var f=h(U,2);b(f,{onclick:i,children:(m,N)=>{M();var g=S();L(()=>D(g,`${Math.round(o.zoom*100)??""}%`)),d(m,g)},$$slots:{default:!0}});var k=h(f,2);b(k,{iconURL:`${R??""}/images/icons/font-awesome/zoom-in.svg`,onclick:r}),d(u,p)},u=>{b(u,{onclick:s,children:(p,U)=>{M();var f=S();L(()=>D(f,`${Math.round(o.zoom*100)??""}%`)),d(p,f)},$$slots:{default:!0}})}),_(t),d(n,t),Q()}var dt=w("<option> </option>"),ct=w("<select></select>");function vt(n,c){let o=re(c,"name",3,"Select one"),l=re(c,"value",15);var r=ct();te(r,21,()=>c.options,oe,(v,s)=>{var i=dt(),t={},y=x(i);_(i),L(()=>{t!==(t=e(s))&&(i.value=(i.__value=e(s))==null?"":e(s)),D(y,e(s))}),d(v,i)}),_(r),L(()=>{me(r,"name",o()),me(r,"id",c.id)}),He(r,l,v=>l(v)),d(n,r)}var ut=w("<!> <!> <!>",1),ft=w('<div class="settings-panel theme-panel svelte-1rflt3x"><!></div>');function mt(n,c){J(c,!0);const o=j(),l=ne();let r=P(()=>l[o.currentPageID]);var v=ft(),s=x(v);C(s,()=>e(r),i=>{var t=ut(),y=q(t);Ze(y,{get value(){return e(r).title},set value(f){e(r).title=f}});var u=h(y,2);Oe(u,{get checked(){return o.spellcheck},set checked(f){o.spellcheck=f},id:"spellcheck",children:(f,k)=>{M();var m=S("Spellcheck");d(f,m)},$$slots:{default:!0}});var p=h(u,2),U=P(Be);vt(p,{id:"theme-select",name:"Theme",get options(){return e(U)},get value(){return o.themeName},set value(f){o.themeName=f}}),d(i,t)},i=>{var t=S("Loading...");d(i,t)}),_(v),d(n,v),Q()}var pt=w('<div class="page-container svelte-1cqpher"><header></header> <main><!> <!> <!> <!></main> <footer class="svelte-1cqpher"><p>Orphans:</p> <!> <!></footer></div>');function Tt(n,c){J(c,!0),j();const o=ne();Fe();const l=Le();var r=pt(),v=h(x(r),2),s=x(v);at(s,{});var i=h(s,2);it(i,{variant:"alt"});var t=h(i,2);rt(t,{});var y=h(t,2);mt(y,{}),_(v);var u=h(v,2),p=h(x(u),2);te(p,17,()=>l.orphanedFolders,oe,(f,k)=>{var m=ee(),N=q(m);C(N,()=>l.tree[e(k)].type==="folder",g=>{b(g,{variant:"error",onclick:()=>{delete l.tree[e(k)]},children:(E,G)=>{M();var Z=S();L(()=>D(Z,`💀📁${l.tree[e(k)].name??""}`)),d(E,Z)},$$slots:{default:!0}})}),d(f,m)});var U=h(p,2);te(U,17,()=>l.orphanedPages,oe,(f,k)=>{b(f,{variant:"error",onclick:()=>{delete l.tree[e(k)],delete o[e(k)]},children:(m,N)=>{M();var g=S();L(()=>D(g,`💀📄${o[e(k)].title??""}`)),d(m,g)},$$slots:{default:!0}})}),_(u),_(r),d(n,r),Q()}export{Tt as component};
